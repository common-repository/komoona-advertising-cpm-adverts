function IsPrice(c){var a,b=c.match(/^([1-9][0-9]*|0)(\.[0-9]{0,2})?$/g);for(a in b){if(b.hasOwnProperty(a)){if(b[a]===c){return true}}}return false}function ValidateEmail(b){var a=/^[\w][\w\._\-]*@(?:[\w\-]+\.?)*[\w]\.[a-zA-Z]{2,4}$/;return a.test(b)}function GetPluginType(b){var a="ads";if(b.search("komoona_adsense")===-1){a="ads"}else{a="adsense"}return a}function handle_ajax_post_back(b,e,d,c){var a=jQuery.parseJSON(b);if(a.status){switch(a.status){case"error":jQuery(d).hide();jQuery(c).slideToggle(400,function(){show_err(e+a.field,a.error)});break;case"success":window.location.href=jQuery(c).attr("action");break}}}function position_warning(a){var b=jQuery("option:selected",a).val();if(b==="SIDEBAR"){jQuery(a).parent().find(".kmn-position-msg").show(200)}else{jQuery(a).parent().find(".kmn-position-msg").hide(200)}}function show_err(a,b){jQuery("#"+a).css({border:"2px solid #a31919","background-color":"#ffd"});if(b!==undefined){jQuery("#"+a+"-error").attr("bt-xtitle",b)}jQuery("#"+a+"-error").btOn();return false}jQuery(document).ready(function(){var c=2,b=7,a=".form-table .form-table select, input, .form-table textarea";jQuery(a).focus(function(){jQuery(a).css({border:"1px solid #dfdfdf","background-color":"#fff"})});jQuery(a).blur(function(){jQuery(a).css({border:"1px solid #dfdfdf","background-color":"#fff"})});jQuery(".kmn-position").change(function(){position_warning(this)}).keypress(function(){jQuery(this).change()});position_warning(jQuery(".kmn-position"));jQuery("#kmn-direct-sales").click(function(){var d=jQuery("#kmn-direct-sales").attr("checked");if(d==="checked"){jQuery("#kmn-direct-sales-div").fadeIn(200)}else{jQuery("#kmn-direct-sales-div").fadeOut(200)}});jQuery("#kmn-a-direct-sales").click(function(){var d=jQuery("#kmn-a-direct-sales").attr("checked");if(d==="checked"){jQuery("#kmn-a-direct-sales-div").fadeIn()}else{jQuery("#kmn-a-direct-sales-div").fadeOut()}});jQuery("a[rel=help-tip]").bt({positions:["right","top"],showTip:function(d){jQuery(d).fadeIn(200)},hideTip:function(d,e){jQuery(d).animate({opacity:0},0,e)},hoverIntentOpts:{interval:0,timeout:0},fill:"#FFF",shadow:true,shadowColor:"rgba(0,0,0,.9)"});jQuery("a[rel=validation-error]").bt({trigger:"none",positions:["right"],strokeWidth:2,strokeStyle:"#a31919",cornerRadius:0,spikeLength:10,spikeGirth:10,fill:"#ffd",shadow:false,cssStyles:{color:"black"}});jQuery("a[rel=rpm-tip]").bt(jQuery("#rpm-help-text").html(),{trigger:["mouseover","click"],positions:["right","top"],showTip:function(d){jQuery(d).fadeIn(200)},hideTip:function(d,e){jQuery(d).animate({opacity:0},0,e)},fill:"#FFF",width:300,height:220,shadow:true,shadowColor:"rgba(0,0,0,.9)"});jQuery("a[rel=adsense-tip]").bt(jQuery("#adsense-help-text").html(),{trigger:"click",fill:"#FFF",shrinkToFit:true,cornerRadius:10,strokeWidth:0,shadow:true,shadowOffsetX:3,shadowOffsetY:3,shadowBlur:8,shadowColor:"rgba(0,0,0,.9)",shadowOverlap:false,clickAnywhereToClose:true,noShadowOpts:{strokeStyle:"#999",strokeWidth:2},positions:["right","top"]});jQuery("a[rel=kmn-account-exists]").click(function(){jQuery("a[rel=adsense-tip]").btOff();jQuery("a[rel=validation-error]").btOff();jQuery("#kmn-create-account").hide(500);jQuery("#kmn-add-tag").show(500)});jQuery("a[rel=kmn-create-account]").click(function(){jQuery("a[rel=adsense-tip]").btOff();jQuery("a[rel=validation-error]").btOff();jQuery("#kmn-add-tag").hide(500);jQuery("#kmn-create-account").show(500)});jQuery("#kmn-submit").click(function(){var e=GetPluginType(jQuery("#kmn-registration-type").val());jQuery("#kmn-registration-type").val(e);jQuery("a[rel=adsense-tip]").btOff();jQuery("a[rel=validation-error]").btOff();if(!ValidateEmail(jQuery("#kmn-username").val())){return show_err("kmn-username")}if(document.getElementById("kmn-password")){if(jQuery.trim(jQuery("#kmn-password").val()).length<b){return show_err("kmn-password")}}var g,d=jQuery.trim(jQuery("#kmn-floor-price").val());if(d!==""){if(IsPrice(d)===false){return show_err("kmn-floor-price","Invalid price format: please set a valid format.")}if(d>c){return show_err("kmn-floor-price","Invalid price: Floor price must be $"+c+" or lower.")}g=jQuery.trim(jQuery("#kmn-adsense").val());if(g.length===0){return show_err("kmn-adsense","Pass-back is required when using a floor price (you can leave both empty)")}}if(document.getElementById("kmn-adsense")){g=jQuery.trim(jQuery("#kmn-adsense").val());if(e==="adsense"&&g.length<10){return show_err("kmn-adsense","Please insert your Google AdSense script")}else{if(e!=="adsense"&&g.length<7&&g.length!==0){return show_err("kmn-adsense","Please insert your pass-back script")}}}var h=jQuery("#kmn-direct-sales").attr("checked");if(h==="checked"){var f=jQuery.trim(jQuery("#kmn-price").val());if(IsPrice(f)===false){return show_err("kmn-price")}if(f<=0){return show_err("kmn-price","Invalid price: price cannot be lower than "+f+" "+jQuery("#kmn_currency").val())}}if(h==="checked"){if(!ValidateEmail(jQuery("#kmn-paypal").val())){return show_err("kmn-paypal")}}if(jQuery("#kmn-toc").attr("checked")!=="checked"){return show_err("kmn-toc")}jQuery("#wait-div").show();jQuery("#create-kmn-account").slideToggle(400);jQuery.ajax({type:"POST",url:jQuery("#create-kmn-account").attr("action"),data:jQuery("#create-kmn-account").serialize(),success:function(i){handle_ajax_post_back(i,"kmn-","#wait-div","#create-kmn-account")}});return false});jQuery("#kmn-a-submit").click(function(){var e=GetPluginType(jQuery("#kmn-a-registration-type").val());jQuery("#kmn-registration-type").val(e);jQuery("a[rel=adsense-tip]").btOff();jQuery("a[rel=validation-error]").btOff();if(!ValidateEmail(jQuery("#kmn-a-username").val())){return show_err("kmn-a-username")}if(document.getElementById("kmn-a-password")){if(jQuery.trim(jQuery("#kmn-a-password").val()).length<b){return show_err("kmn-a-password")}}var g,d=jQuery.trim(jQuery("#kmn-a-floor-price").val());if(d!==""){if(IsPrice(d)===false){return show_err("kmn-a-floor-price","Invalid price format: please set a valid format.")}if(d>c){return show_err("kmn-a-floor-price","Invalid price: Floor price must be $"+c+" or lower.")}g=jQuery.trim(jQuery("#kmn-a-adsense").val());if(g.length===0){return show_err("kmn-a-adsense","Pass-back is required when using a floor price (you can leave both empty)")}}if(document.getElementById("kmn-a-adsense")){g=jQuery.trim(jQuery("#kmn-a-adsense").val());if(e==="adsense"&&g.length<10){return show_err("kmn-a-adsense","Please insert your Google AdSense script")}else{if(e!=="adsense"&&g.length<7&&g.length!==0){return show_err("kmn-a-adsense","Please insert your pass-back script")}}}var h=jQuery("#kmn-a-direct-sales").attr("checked");if(h==="checked"){var f=jQuery.trim(jQuery("#kmn-a-price").val());if(IsPrice(f)===false){return show_err("kmn-a-price")}if(f<=0){return show_err("kmn-a-price","Invalid price: price cannot be lower than "+f+" "+jQuery("#kmn_currency").val())}}if(h==="checked"){if(!ValidateEmail(jQuery("#kmn-a-paypal").val())){return show_err("kmn-a-paypal")}}jQuery("#wait-div-a").show();jQuery("#add-kmn-site").slideToggle(400);jQuery.ajax({type:"POST",url:jQuery("#add-kmn-site").attr("action"),data:jQuery("#add-kmn-site").serialize(),success:function(i){handle_ajax_post_back(i,"kmn-a-","#wait-div-a","#add-kmn-site")}});return false});jQuery("a[rel=kmn-expand-div]").click(function(){var d=jQuery(this).find("img").attr("src");if(d.indexOf("expand")!==-1){jQuery(this).find("img").attr("src",d.replace("expand","collapse"));jQuery(this).find("img").attr("title","collapse")}else{jQuery(this).find("img").attr("src",d.replace("collapse","expand"));jQuery(this).find("img").attr("title","expand")}jQuery("#kmn-advanced-settings").slideToggle(300)});jQuery(".kmn-advanced-header").click(function(){var d=jQuery("a[rel=kmn-expand-div]").find("img").attr("src");if(d.indexOf("expand")!==-1){jQuery("a[rel=kmn-expand-div]").find("img").attr("src",d.replace("expand","collapse"));jQuery("a[rel=kmn-expand-div]").find("img").attr("title","collapse")}else{jQuery("a[rel=kmn-expand-div]").find("img").attr("src",d.replace("collapse","expand"));jQuery("a[rel=kmn-expand-div]").find("img").attr("title","expand")}jQuery("#kmn-advanced-settings").slideToggle(300)})});